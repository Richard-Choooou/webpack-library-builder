!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UniversalBridge=t():e.UniversalBridge=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e=16){const t=["1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];let n="";for(let i=0;i<e;i++)n+=t[Math.floor(Math.random()*t.length)];return n}function a(e){if("[object Object]"===Object.prototype.toString.call(e))if("$$senguoBridgePrivate"in e){if("file"===e.$$type)return function(e,t,n){let i=atob(n),a=i.length,r=new Uint8Array(a);for(;a--;)r[a]=i.charCodeAt(a);return new File([r],e,{type:t})}(e.name,e.mimeType,e.base64)}else for(let t in e)e[t]=a(e[t]);else if("[object Array]"===Object.prototype.toString.call(e))for(let t=0;t<e.lenght;t++)e[t]=a(e[t]);return e}e.d(t,{default:function(){return l}});const r=navigator.userAgent,c=!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);r.indexOf("Android")>-1||r.indexOf("Adr");const o={fileType:{image:c?"public.image":"image/*",video:c?"public.movie":"video/*"}};class s{constructor(){n(this,"isReady",!1),n(this,"listenReadyFn",new Set),n(this,"eventMap",{}),n(this,"callbackMap",{}),n(this,"define",o),this.initWebInterface(),this.addEventListener("onReady",(()=>this._setBridgeReady()))}initWebInterface(){window.senguoJsBridgeWebSide=this}canIUse(e,t,n){this.sendEventToClient("$$bridge","canIUse",{module:e,service:t},n)}getServiceInfo(e,t,n){this.sendEventToClient("$$bridge","getServiceInfo",{module:e,service:t},n)}onReady(e){this.isReady?e():this.listenReadyFn.add(e)}addEventListener(e,t){return this.eventMap[e]=this.eventMap[e]||new Set,this.eventMap[e].add(t),()=>{this.eventMap[e].delete(t)}}_dispatchEvent(e,t){console.log("jsBridgeRawEvent",e,t);const n=a(t);if(console.log(n),"invokeCallback"===e){if(n.callbackName){const e=this.callbackMap[n.callbackName];if(Reflect.deleteProperty(this.callbackMap,n.callbackName),e)return e(n.callbackData)}}else{const t=this.eventMap[e];t&&t.forEach((e=>e(n)))}}removeEventListener(e,t){this.eventMap[e]=this.eventMap[e]||new Set,this.eventMap[e].delete(t)}sendEventToClient(e,t,n,a){if(a){const r=i(32);this.callbackMap[r]=a,this.clientInterfaceAdapter({target:e,action:t,params:n,callbackName:r})}else if(n)if("[object Object]"===Object.prototype.toString.call(n))this.clientInterfaceAdapter({target:e,action:t,params:n});else if("[object Function]"===Object.prototype.toString.call(n)){const a=i(32);this.callbackMap[a]=n,this.clientInterfaceAdapter({target:e,action:t,params:{},callbackName:a})}else console.warn(`[jsBridge] 错误的参数类型：${n}，仅能传入键值对对象或者函数`),this.clientInterfaceAdapter({target:e,action:t});else this.clientInterfaceAdapter({target:e,action:t})}_setBridgeReady(){this.isReady=!0,this.listenReadyFn.forEach((e=>e())),this.listenReadyFn.clear()}}var l=c?new class extends s{constructor(){super()}clientInterfaceAdapter(e){window.webkit.messageHandlers.senguoBridge.postMessage(e)}}:new class extends s{constructor(){super()}clientInterfaceAdapter(e){window.senguoBridge.sendEvent(JSON.stringify(e))}};return t.default}()}));